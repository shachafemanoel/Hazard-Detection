<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Model Loading Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .log { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>ONNX Model Loading Test</h1>
    <button onclick="testModelLoading()">Test Model Loading</button>
    <div id="logs"></div>

    <script type="module">
        import { loadONNXRuntime, createInferenceSession } from './public/js/onnx-runtime-loader.js';

        function addLog(message, type = 'info') {
            const logs = document.getElementById('logs');
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `${new Date().toLocaleTimeString()}: ${message}`;
            logs.appendChild(div);
            console.log(message);
        }

        window.testModelLoading = async function() {
            document.getElementById('logs').innerHTML = '';
            
            try {
                addLog('🔄 Starting ONNX model loading test...', 'info');

                // Load ONNX Runtime
                addLog('Loading ONNX Runtime...', 'info');
                const ort = await loadONNXRuntime();
                addLog('✅ ONNX Runtime loaded successfully', 'success');

                // Test model loading
                const modelPath = './public/object_detection_model/best0608.onnx';
                addLog(`🔍 Loading model from: ${modelPath}`, 'info');

                const session = await createInferenceSession(modelPath);
                addLog('✅ Model loaded successfully!', 'success');

                // Display model info
                addLog(`📋 Input names: ${session.inputNames.join(', ')}`, 'info');
                addLog(`📋 Output names: ${session.outputNames.join(', ')}`, 'info');

                // Get input metadata
                const inputName = session.inputNames[0];
                const inputMeta = session.inputMetadata[inputName];
                addLog(`📐 Input shape: ${JSON.stringify(inputMeta.dims || inputMeta.shape)}`, 'info');

                // Clean up
                session.dispose();
                addLog('🗑️ Session disposed successfully', 'success');
                addLog('🎉 Test completed successfully!', 'success');

            } catch (error) {
                addLog(`❌ Error: ${error.message}`, 'error');
                console.error('Full error:', error);
            }
        }
    </script>
</body>
</html>