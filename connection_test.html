<!DOCTYPE html>
<html>
<head>
    <title>Frontend-Backend Connection Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #0f5132; border: 1px solid #198754; }
        .error { background: #842029; border: 1px solid #dc3545; }
        .info { background: #055160; border: 1px solid #0dcaf0; }
        .loading { background: #664d03; border: 1px solid #ffca2c; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background: #0d6efd; color: white; }
        .btn-success { background: #198754; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        code { background: #333; padding: 2px 4px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üîß Hazard Detection Connection Test</h1>
    
    <div id="status" class="test-result info">
        Ready to test connections...
    </div>
    
    <button class="btn-primary" onclick="testBackendConnection()">Test Backend Connection</button>
    <button class="btn-success" onclick="testFrontendModel()">Test Frontend Model</button>
    <button class="btn-danger" onclick="runFullDiagnostics()">Full Diagnostics</button>
    
    <div id="results"></div>
    
    <script>
        const results = document.getElementById('results');
        const status = document.getElementById('status');
        
        function updateStatus(message, type = 'info') {
            status.className = `test-result ${type}`;
            status.textContent = message;
        }
        
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }
        
        async function testBackendConnection() {
            updateStatus('Testing backend connection...', 'loading');
            addResult('üîç Testing Backend Connection...', 'info');
            
            const candidates = [
                'https://hazard-detection-backend.onrender.com',
                'http://localhost:8000'
            ];
            
            for (const url of candidates) {
                try {
                    addResult(`Testing: <code>${url}</code>`, 'info');
                    
                    const response = await fetch(`${url}/health`, {
                        method: 'GET',
                        signal: AbortSignal.timeout(10000)
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        addResult(`‚úÖ Backend connected: <code>${url}</code><br>
                                   Status: ${data.status}<br>
                                   Model: ${data.model_status}<br>
                                   Type: ${data.backend_type}`, 'success');
                        updateStatus('Backend connection successful!', 'success');
                        return;
                    } else {
                        addResult(`‚ùå Backend responded with status: ${response.status}`, 'error');
                    }
                } catch (error) {
                    addResult(`‚ùå Failed to connect to <code>${url}</code>: ${error.message}`, 'error');
                }
            }
            
            updateStatus('All backend connections failed', 'error');
        }
        
        async function testFrontendModel() {
            updateStatus('Testing frontend model...', 'loading');
            addResult('üß† Testing Frontend Model...', 'info');
            
            const modelPaths = [
                '/object_detecion_model/model_18_7.onnx',
                './object_detecion_model/model_18_7.onnx'
            ];
            
            for (const path of modelPaths) {
                try {
                    addResult(`Testing model at: <code>${path}</code>`, 'info');
                    
                    const response = await fetch(path, { method: 'HEAD' });
                    if (response.ok) {
                        const size = response.headers.get('content-length');
                        addResult(`‚úÖ Model found: <code>${path}</code><br>
                                   Size: ${size ? (size / 1024 / 1024).toFixed(1) + 'MB' : 'Unknown'}`, 'success');
                        updateStatus('Frontend model accessible!', 'success');
                        return;
                    }
                } catch (error) {
                    addResult(`‚ùå Model not accessible at <code>${path}</code>: ${error.message}`, 'error');
                }
            }
            
            updateStatus('Frontend model not found', 'error');
        }
        
        async function runFullDiagnostics() {
            updateStatus('Running full diagnostics...', 'loading');
            results.innerHTML = '';
            
            addResult('üöÄ Full System Diagnostics', 'info');
            
            // Environment info
            addResult(`üìä Environment:<br>
                       URL: <code>${window.location.href}</code><br>
                       User Agent: <code>${navigator.userAgent.substring(0, 100)}...</code><br>
                       Hardware Concurrency: ${navigator.hardwareConcurrency}<br>
                       Online: ${navigator.onLine}`, 'info');
            
            // Test both connections
            await testBackendConnection();
            await testFrontendModel();
            
            // Test WebGL
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (gl) {
                    addResult(`‚úÖ WebGL Support Available<br>
                               Version: ${gl.getParameter(gl.VERSION)}<br>
                               Vendor: ${gl.getParameter(gl.VENDOR)}`, 'success');
                } else {
                    addResult('‚ùå WebGL not supported', 'error');
                }
            } catch (e) {
                addResult(`‚ùå WebGL test failed: ${e.message}`, 'error');
            }
            
            updateStatus('Diagnostics complete', 'success');
        }
        
        // Auto-run basic test on load
        window.addEventListener('load', () => {
            setTimeout(testBackendConnection, 1000);
        });
    </script>
</body>
</html>