<!doctype html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="/assets/icon.png" type="image/png" />
    <title>Reset Password</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    
    <!-- Unified Design System -->
    <link rel="stylesheet" href="/styles/unified-design.css" />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Poppins", sans-serif;
      }
      .btn-modern {
        font-size: 0.875rem;
        font-weight: 500;
        letter-spacing: 0.025em;
        transition: all 0.2s;
      }
      .btn-modern:hover {
        transform: translateY(-1px);
      }
    </style>
  </head>
  <body class="page-container">
    <!-- Unified Navigation -->
    <div id="unified-navigation-container"></div>
    
    <div class="main-content flex items-center justify-center" style="min-height: 80vh;">
      <div class="glass-card" style="max-width: 400px; width: 100%;">
        <h2 class="text-center mb-4" style="color: var(--text-primary); font-size: var(--font-size-2xl); font-weight: 700;">
          Reset Your Password
        </h2>

        <form id="reset-password-form" class="mb-3">
          <div class="mb-3">
            <input
              type="password"
              id="new-password"
              placeholder="Enter new password"
              required
              class="form-control"
            />
          </div>
          <button type="submit" class="btn btn-primary w-full">
            Reset Password
          </button>
        </form>

        <p id="reset-message" class="text-center mt-3" style="font-size: var(--font-size-sm);"></p>
      </div>
    </div>

    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get("token");
      const form = document.getElementById("reset-password-form");
      const message = document.getElementById("reset-message");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const password = document.getElementById("new-password").value.trim();

        // ולידציה בסיסית
        const valid = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/.test(password);
        if (!valid) {
          message.style.color = "red";
          message.textContent =
            "Password must be at least 8 characters and contain letters and numbers.";
          return;
        }

        try {
          const res = await fetch("/reset-password", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ token, password }),
          });

          const data = await res.json();
          if (res.ok) {
            message.style.color = "green";
            message.textContent = "Password reset successfully! Redirecting...";
            setTimeout(
              () => (window.location.href = "/pages/index.html"),
              4000,
            );
          } else {
            message.style.color = "red";
            message.textContent = data.error || "Reset failed.";
          }
        } catch (err) {
          console.error("Reset error:", err);
          message.style.color = "red";
          message.textContent = "Server error.";
        }
      });
    </script>
    
    <!-- Load Unified Navigation -->
    <script>
      // Load unified navigation component
      fetch('/components/navigation/unified-nav.html')
        .then(response => response.text())
        .then(html => {
          document.getElementById('unified-navigation-container').innerHTML = html;
          // Load navigation JavaScript
          const script = document.createElement('script');
          script.src = '/components/navigation/unified-nav.js';
          document.head.appendChild(script);
        })
        .catch(error => console.error('Error loading navigation:', error));
    </script>
  </body>
</html>
