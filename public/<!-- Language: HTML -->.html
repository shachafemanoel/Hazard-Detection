<!-- Language: HTML -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Tests</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mocha/10.2.0/mocha.min.css">
    <style>
        /* Hide test container UI */
        #test-container { display: none; }
    </style>
</head>
<body>
    <div id="mocha"></div>

    <!-- Minimal DOM for testing -->
    <div id="test-container">
        <nav id="mySidebar" class="sidebar"></nav>
        <button id="sidebarToggle">Toggle Sidebar</button>
        <button id="sidebarCloseBtn">Close Sidebar</button>
        <div id="mainContent"></div>
        <button id="toggleMapBtn">Map</button>
        <button id="toggleReportsBtn">Reports</button>
        <button id="toggle-filters-btn">Filters</button>
    </div>

    <!-- Inline script replicating dashboard.html functionality -->
    <script>
        const sidebar = document.getElementById('mySidebar');
        const sidebarToggleBtn = document.getElementById('sidebarToggle');
        const sidebarCloseBtn = document.getElementById('sidebarCloseBtn');
        const mainContent = document.getElementById('mainContent');

        function toggleSidebar() {
            sidebar.classList.toggle('open');
            mainContent.classList.toggle('shifted');
        }

        sidebarToggleBtn.addEventListener('click', toggleSidebar);
        sidebarCloseBtn.addEventListener('click', toggleSidebar);

        // Close the sidebar when clicking outside of it
        document.addEventListener('click', function(event) {
            if (sidebar.classList.contains('open') && !sidebar.contains(event.target) && event.target !== sidebarToggleBtn) {
                toggleSidebar();
            }
        });

        // Dummy initMap for testing
        function initMap() {}
        window.initMap = window.initMap || initMap;
    </script>

    <!-- Optionally include dashboard.js -->
    <script src="js/dashboard.js"></script>

    <!-- Mocha and Chai Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mocha/10.2.0/mocha.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chai/4.3.7/chai.min.js"></script>

    <!-- Test Script -->
    <script>
        mocha.setup('bdd');
        const expect = chai.expect;

        describe('Dashboard UI Tests', function() {
            beforeEach(function() {
                // Reset sidebar and mainContent states before each test.
                sidebar.classList.remove('open');
                mainContent.classList.remove('shifted');
            });

            it('should toggle sidebar classes when toggleSidebar is called', function() {
                expect(sidebar.classList.contains('open')).to.be.false;
                expect(mainContent.classList.contains('shifted')).to.be.false;
                toggleSidebar();
                expect(sidebar.classList.contains('open')).to.be.true;
                expect(mainContent.classList.contains('shifted')).to.be.true;
                toggleSidebar();
                expect(sidebar.classList.contains('open')).to.be.false;
                expect(mainContent.classList.contains('shifted')).to.be.false;
            });

            it('should open sidebar when sidebarToggleBtn is clicked', function() {
                sidebar.classList.remove('open');
                mainContent.classList.remove('shifted');
                sidebarToggleBtn.click();
                expect(sidebar.classList.contains('open')).to.be.true;
                expect(mainContent.classList.contains('shifted')).to.be.true;
            });

            it('should close sidebar when sidebarCloseBtn is clicked', function() {
                // Open sidebar first.
                sidebar.classList.add('open');
                mainContent.classList.add('shifted');
                sidebarCloseBtn.click();
                expect(sidebar.classList.contains('open')).to.be.false;
                expect(mainContent.classList.contains('shifted')).to.be.false;
            });

            it('should close sidebar when clicking outside', function() {
                // Open the sidebar first.
                sidebar.classList.add('open');
                mainContent.classList.add('shifted');
                // Create a dummy element outside the sidebar.
                const dummy = document.createElement('div');
                document.body.appendChild(dummy);
                dummy.click();
                expect(sidebar.classList.contains('open')).to.be.false;
                expect(mainContent.classList.contains('shifted')).to.be.false;
                document.body.removeChild(dummy);
            });

            it('should have a global initMap function', function() {
                expect(window.initMap).to.be.a('function');
            });

            it('should have toggle buttons present', function() {
                const toggleMapBtn = document.getElementById('toggleMapBtn');
                const toggleReportsBtn = document.getElementById('toggleReportsBtn');
                const toggleFiltersBtn = document.getElementById('toggle-filters-btn');
                expect(toggleMapBtn).to.not.be.null;
                expect(toggleReportsBtn).to.not.be.null;
                expect(toggleFiltersBtn).to.not.be.null;
            });
        });

        mocha.run();
    </script>
</body>
</html>