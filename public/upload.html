<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="icon.png" type="image/png">
  <title>Hazard Detection - Upload</title>

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <!-- Custom Design System CSS -->
  <link rel="stylesheet" href="css/design-system.css">
  <link rel="stylesheet" href="css/floating-menu.css">
  <style>
    body {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    }
    .canvas-container {
      border: 2px dashed #475569;
      transition: all 0.3s ease;
    }
    .canvas-container.drag-over {
      border-color: #3b82f6;
      background-color: rgba(59, 130, 246, 0.1);
    }
  </style>
</head>
<body>
  <!-- Floating Menu -->
  <button class="floating-menu-btn" id="menuBtn"><i class="fas fa-bars"></i></button>
  <nav class="floating-menu" id="floatingMenu">
      <a href="/dashboard.html"><i class="fas fa-chart-line"></i><span>Dashboard</span></a>
      <a href="/camera.html"><i class="fas fa-camera"></i><span>Camera</span></a>
      <a href="/upload.html" class="active"><i class="fas fa-upload"></i><span>Upload</span></a>
      <a href="/logout"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a>
  </nav>
  <div class="menu-overlay" id="menuOverlay"></div>
  
  <div class="page-content">
  <div class="container my-5">
    <div class="row justify-content-center">
      <div class="col-12 col-lg-10">
        <div class="card p-4 p-sm-5">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h1 class="h3">Upload Image for Detection</h1>
              <div class="d-flex align-items-center gap-2">
                  <span class="badge bg-primary mode-badge">Upload</span>
                  <span class="badge bg-secondary status-indicator">Ready</span>
              </div>
            </div>
            
            <div class="row g-4">
              <!-- Left Column: Upload & Preview -->
              <div class="col-md-8">
                <div class="mb-3">
                  <label for="image-upload" class="form-label">Select Image:</label>
                  <input type="file" id="image-upload" accept="image/*" class="form-control">
                </div>
                <div class="canvas-container rounded p-3 text-center" style="min-height: 400px;">
                  <canvas id="preview-canvas"></canvas>
                  <p class="text-muted d-none" id="upload-prompt">Drag & Drop or Select an Image</p>
                </div>
              </div>

              <!-- Right Column: Controls -->
              <div class="col-md-4">
                <div class="p-3 bg-dark rounded">
                  <h5 class="mb-3">Controls</h5>
                  <div class="mb-4">
                    <label for="confidence-slider" class="form-label">Confidence: <span id="conf-value">0.5</span></label>
                    <input type="range" id="confidence-slider" min="0" max="1" step="0.05" value="0.5" class="form-range">
                  </div>
                  <div class="d-grid gap-2">
                    <button id="get-location-btn" class="btn btn-outline-info btn-icon-left"><i class="fas fa-map-marker-alt"></i><span>Get Location</span></button>
                    <button id="save-detection" class="btn btn-success btn-icon-left" disabled><i class="fas fa-save"></i><span>Save Detection</span></button>
                  </div>
                  <div id="tooltip" class="d-none position-absolute bg-dark text-white p-2 rounded">No Hazard Detected</div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
  </div><!-- /.page-content -->
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/exif-js/2.3.0/exif.min.js"></script>
  <script type="module">
    import * as ort from "/ort/ort.min.mjs";
    ort.env.wasm.wasmPaths = "/ort/";
    const isIsolated = typeof window !== "undefined" && window.crossOriginIsolated === true;
    ort.env.wasm.numThreads = isIsolated ? Math.min(navigator.hardwareConcurrency || 1, 4) : 1;
    window.ort = ort;
  </script>
  <script src="js/error-handler.js"></script>
  <script src="js/notifications.js"></script>
  <script src="js/smoke-tests.js"></script>
  <script type="module" src="js/upload.js" defer></script>
  <script>
    // Floating menu logic
    document.addEventListener('DOMContentLoaded', function() {
        const menuBtn = document.getElementById('menuBtn');
        const floatingMenu = document.getElementById('floatingMenu');
        const menuOverlay = document.getElementById('menuOverlay');
        menuBtn.addEventListener('click', () => {
            const isOpen = floatingMenu.classList.toggle('active');
            menuOverlay.classList.toggle('active', isOpen);
        });
        menuOverlay.addEventListener('click', () => {
            floatingMenu.classList.remove('active');
            menuOverlay.classList.remove('active');
        });
    });
  </script>
  <script>
    // Prevent menu overlay on desktop by shifting content
    (function(){
      const style = document.createElement('style');
      style.innerHTML = `
        .page-content{ transition: margin-left .3s ease; }
        @media (min-width:1024px){
          .page-content{ margin-left:72px; }
          .floating-menu:hover ~ .page-content{ margin-left:280px; }
        }
      `;
      document.head.appendChild(style);
    })();
  </script>
</body>
</html>
