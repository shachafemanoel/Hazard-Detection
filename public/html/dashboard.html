<!-- public/html/dashboard.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="../css/dashboard.css">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA9qkNEaiu9vpTB0bzqhw_Ei55Mt2UqN3A&callback=initMap" async defer></script>
</head>
<body>
    <div id="dashboard-container">
        <button onclick="location.href='/upload'">Report a Hazard</button>
        <h1>Dashboard</h1>

        <!-- Google Map -->
        <div id="map" style="height: 60vh;"></div>

        <!-- Toggle Button to Minimize Reports Table -->
        <button id="toggleBtn" onclick="toggleReports()">Minimize Reports</button>

        <!-- Reports Table -->
        <div id="reports" style="height: 40vh; overflow-y: auto;">
            <h2>Reports Log</h2>
            <table>
                <thead>
                    <tr>
                        <th>Hazard ID</th>
                        <th>Hazard Type</th>
                        <th>Location</th>
                        <th>Report Time</th>
                        <th>Image</th>
                        <th>Status</th>
                        <th>Reported By</th>
                    </tr>
                </thead>
                <tbody id="reports-body">
                    <!-- Reports will be dynamically populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Initialize Google Map with Israel's region
        function initMap() {
            const israel = { lat: 31.7683, lng: 35.2137 }; // Coordinates of Israel
            const map = new google.maps.Map(document.getElementById("map"), {
                zoom: 8,
                center: israel,
            });

            // Optionally add markers to the map
            new google.maps.Marker({
                position: israel,
                map: map,
                title: "Israel",
            });
        }

        // Toggle Reports Table
        function toggleReports() {
            const reports = document.getElementById('reports');
            const toggleBtn = document.getElementById('toggleBtn');
            if (reports.style.display === 'none') {
                reports.style.display = 'block';
                toggleBtn.textContent = 'Minimize Reports';
                document.getElementById('map').style.height = '60vh';
            } else {
                reports.style.display = 'none';
                toggleBtn.textContent = 'Maximize Reports';
                document.getElementById('map').style.height = '100vh';
            }
        }

        // Fetch reports from the server and populate the table
        async function fetchReports() {
            const response = await fetch('/api/reports');
            const reports = await response.json();
            
            const tbody = document.getElementById('reports-body');
            tbody.innerHTML = ''; // Clear the existing rows

            reports.forEach(report => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${report.id}</td>
                    <td>${report.type}</td>
                    <td>${report.location}</td>
                    <td>${report.time}</td>
                    <td>
                        ${report.image ? 
                            `<img src="${report.image}" alt="image" width="50">` :
                            "No Image"
                        }
                    </td>
                    <td>${report.status}</td>
                    <td>${report.reportedBy}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Call fetchReports on page load
        window.onload = fetchReports;
    </script>
    <script src="../js/dashboard.js" defer></script>
</body>
</html>
